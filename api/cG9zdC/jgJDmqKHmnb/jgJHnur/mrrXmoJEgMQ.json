{"title":"P3372 【模板】线段树 1","date":"2018-10-21T13:26:19.000Z","slug":"【模板】线段树 1","tags":["Luogu","模板"],"updated":"2018-10-21T14:25:12.738Z","content":"<h2 id=\"题面\"><a href=\"#题面\" class=\"headerlink\" title=\"题面\"></a>题面</h2><h3 id=\"题目描述\"><a href=\"#题目描述\" class=\"headerlink\" title=\"题目描述\"></a>题目描述</h3><p>如题，已知一个数列，你需要进行下面两种操作：<br>1.将某区间每一个数加上x<br>2.求出某区间每一个数的和</p>\n<h4 id=\"输入输出格式\"><a href=\"#输入输出格式\" class=\"headerlink\" title=\"输入输出格式\"></a>输入输出格式</h4><h4 id=\"输入格式：\"><a href=\"#输入格式：\" class=\"headerlink\" title=\"输入格式：\"></a>输入格式：</h4><p>第一行包含两个整数N、M，分别表示该数列数字的个数和操作的总个数。<br>第二行包含N个用空格分隔的整数，其中第i个数字表示数列第i项的初始值。<br>接下来M行每行包含3或4个整数，表示一个操作，具体如下：<br>操作1： 格式：1 x y k 含义：将区间[x,y]内每个数加上k<br>操作2： 格式：2 x y 含义：输出区间[x,y]内每个数的和</p>\n<h4 id=\"输出格式：\"><a href=\"#输出格式：\" class=\"headerlink\" title=\"输出格式：\"></a>输出格式：</h4><p>输出包含若干行整数，即为所有操作2的结果。</p>\n<h4 id=\"输入输出样例\"><a href=\"#输入输出样例\" class=\"headerlink\" title=\"输入输出样例\"></a>输入输出样例</h4><blockquote>\n<p>输入样例#1：<br>5 5<br>1 5 4 2 3<br>2 2 4<br>1 2 3 2<br>2 3 4<br>1 1 5 1<br>2 1 4<br>输出样例#1：<br>11<br>8<br>20</p>\n</blockquote>\n<h3 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h3><p>时空限制：1000ms,128M<br>数据规模：<br>对于30%的数据：N&lt;=8，M&lt;=10<br>对于70%的数据：N&lt;=1000，M&lt;=10000<br>对于100%的数据：N&lt;=100000，M&lt;=100000<br>（数据已经过加强^_^，保证在int64/long long数据范围内）</p>\n<hr>\n<p>线段树其实学会很久了<del>学了就忘</del>，现在要学主席树，先再来补一发</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;bits/stdc++.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> maxpoint 100010</span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> <span class=\"title\">read</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> w=<span class=\"number\">1</span>,x=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">char</span> ch=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (ch&lt;<span class=\"string\">'0'</span>||ch&gt;<span class=\"string\">'9'</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (ch==<span class=\"string\">'-'</span>) w=<span class=\"number\">-1</span>;</span><br><span class=\"line\">\t\tch=getchar();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span>(ch&gt;=<span class=\"string\">'0'</span>&amp;&amp;ch&lt;=<span class=\"string\">'9'</span>)&#123;</span><br><span class=\"line\">\t\tx=(x&lt;&lt;<span class=\"number\">1</span>)+(x&lt;&lt;<span class=\"number\">3</span>)+ch-<span class=\"string\">'0'</span>;</span><br><span class=\"line\">\t\tch=getchar();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> x*w;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> _write(<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> x)&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (x/<span class=\"number\">10</span>&gt;<span class=\"number\">0</span>) _write(x/<span class=\"number\">10</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">putchar</span>(x%<span class=\"number\">10</span>+<span class=\"string\">'0'</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">write</span><span class=\"params\">(<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> x)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (x&lt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">putchar</span>(<span class=\"string\">'-'</span>);</span><br><span class=\"line\">\t\tx=-x;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t_write(x);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">long</span> <span class=\"keyword\">long</span> po_int,qu_es;</span><br><span class=\"line\"><span class=\"keyword\">long</span> <span class=\"keyword\">long</span> a[maxpoint];</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">node</span>&#123;</span></span><br><span class=\"line\">\t<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> val,tag;</span><br><span class=\"line\">&#125;tree[maxpoint*<span class=\"number\">4</span>];</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">push_up</span><span class=\"params\">(<span class=\"keyword\">int</span> ro_ot)</span></span>&#123;</span><br><span class=\"line\">\ttree[ro_ot].val=tree[ro_ot&lt;&lt;<span class=\"number\">1</span>].val+tree[ro_ot&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>].val;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">build</span><span class=\"params\">(<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> ro_ot,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> la,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> lb)</span></span>&#123;</span><br><span class=\"line\">\ttree[ro_ot].tag=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (la==lb) &#123;</span><br><span class=\"line\">\t\ttree[ro_ot].val=a[la];</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> mid=(la+lb)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\tbuild(ro_ot&lt;&lt;<span class=\"number\">1</span>,la,mid);</span><br><span class=\"line\">\tbuild(ro_ot&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>,mid+<span class=\"number\">1</span>,lb);</span><br><span class=\"line\">\tpush_up(ro_ot);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">taging</span><span class=\"params\">(<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> ro_ot,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> la,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> lb,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> val)</span></span>&#123;</span><br><span class=\"line\">\ttree[ro_ot].tag+=val;</span><br><span class=\"line\">\ttree[ro_ot].val+=(lb-la+<span class=\"number\">1</span>)*val;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">push_down</span><span class=\"params\">(<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> ro_ot,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> la,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> lb)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> mid=(lb+la)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\ttaging(ro_ot&lt;&lt;<span class=\"number\">1</span>,la,mid,tree[ro_ot].tag);</span><br><span class=\"line\">\ttaging(ro_ot&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>,mid+<span class=\"number\">1</span>,lb,tree[ro_ot].tag);</span><br><span class=\"line\">\ttree[ro_ot].tag=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">update</span><span class=\"params\">(<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> check_la,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> check_lb,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> la,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> lb,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> ro_ot,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> val)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (check_la&lt;=la&amp;&amp;check_lb&gt;=lb)&#123;</span><br><span class=\"line\">\t\ttree[ro_ot].val+=(lb-la+<span class=\"number\">1</span>)*val;</span><br><span class=\"line\">\t\ttree[ro_ot].tag+=val;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> mid=(la+lb)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\tpush_down(ro_ot,la,lb);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (check_la&lt;=mid) update(check_la,check_lb,la,mid,ro_ot&lt;&lt;<span class=\"number\">1</span>,val);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (check_lb&gt;mid)  update(check_la,check_lb,mid+<span class=\"number\">1</span>,lb,ro_ot&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>,val);</span><br><span class=\"line\">\tpush_up(ro_ot);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">long</span> <span class=\"keyword\">long</span> <span class=\"title\">query</span><span class=\"params\">(<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> check_la,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> check_lb,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> la,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> lb,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> ro_ot)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (check_la&lt;=la&amp;&amp;check_lb&gt;=lb)&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> tree[ro_ot].val;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> ans=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> mid=(la+lb)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\tpush_down(ro_ot,la,lb);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (check_la&lt;=mid) ans+=query(check_la,check_lb,la,mid,ro_ot&lt;&lt;<span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (check_lb&gt;mid) ans+=query(check_la,check_lb,mid+<span class=\"number\">1</span>,lb,ro_ot&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>);</span><br><span class=\"line\">\tpush_up(ro_ot);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ans;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tpo_int=read();qu_es=read();</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=po_int;i++)</span><br><span class=\"line\">\t\ta[i]=read();</span><br><span class=\"line\">\tbuild(<span class=\"number\">1</span>,<span class=\"number\">1</span>,po_int);</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> x;</span><br><span class=\"line\">\t<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> check_la,check_lb,val;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=qu_es;i++)&#123;</span><br><span class=\"line\">\t\tx=read();</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (x==<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">\t\t\tcheck_la=read();check_lb=read();val=read();</span><br><span class=\"line\">\t\t\tupdate(check_la,check_lb,<span class=\"number\">1</span>,po_int,<span class=\"number\">1</span>,val);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tcheck_la=read();check_lb=read();</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span>&lt;&lt;query(check_la,check_lb,<span class=\"number\">1</span>,po_int,<span class=\"number\">1</span>);<span class=\"comment\">//write(query(check_la,check_lb,1,po_int,1));</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">putchar</span>(<span class=\"string\">'\\n'</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","prev":{"title":"输入输出模板","slug":"输入输出模板"},"next":{"title":"P3379【模板】最近公共祖先（LCA）","slug":"【模板】最近公共祖先（LCA）"},"link":"http://yoursite.com/post/【模板】线段树 1/","toc":[{"title":"题面","id":"题面","index":"1","children":[{"title":"题目描述","id":"题目描述","index":"1.1","children":[{"title":"输入格式：","id":"输入格式：","index":"1.1.1"},{"title":"输出格式：","id":"输出格式：","index":"1.1.2"},{"title":"输入输出样例","id":"输入输出样例","index":"1.1.3"}]},{"title":"说明","id":"说明","index":"1.2"}]}]}